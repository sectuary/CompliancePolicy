{
  "category": "Custom Policy",
  "subcategory": "Generated from ABS Cloud Computing Implementation Guide 3.0",
  "version": "1.0.0",
  "generated_at": "2025-12-04T02:35:06.449Z",
  "source_document": "abs-cloud-computing-implementation-guide---july-2024.md",
  "source_repo": "sectuary/CompliancePolicy",
  "standards": [
    {
      "id": "CUSTOM-POLICY-101",
      "title": "Storage Account Encryption Not Using Customer-Managed Keys",
      "description": "Storage accounts should use customer-managed encryption keys (BYOK) to maintain control over cryptographic material as recommended in the guide's cryptographic key management section.",
      "severity": "HIGH",
      "rationale": "Using customer-managed keys ensures the FI maintains control over encryption keys and can meet data sovereignty requirements. CSP-managed keys may not provide sufficient control for sensitive financial data.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.encryption.keySource",
            "notEquals": "Microsoft.Keyvault"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify an Azure Key Vault with appropriate access policies",
          "Generate or import a customer-managed key in the Key Vault",
          "Configure the storage account to use the customer-managed key for encryption",
          "Verify encryption settings and test key rotation procedures"
        ],
        "example_fix": "az storage account update --name <storage-account> --resource-group <rg> --encryption-key-source Microsoft.Keyvault --encryption-key-vault <key-vault-uri> --encryption-key-name <key-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-102",
      "title": "Storage Account Allows Public Network Access",
      "description": "Storage accounts should disable public network access and require private endpoints or service endpoints to prevent unauthorized internet access.",
      "severity": "CRITICAL",
      "rationale": "Public network access increases the attack surface and violates the principle of network segregation. Financial data should only be accessible through secured, private connections.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create private endpoints for the storage account",
          "Configure DNS to resolve to private endpoints",
          "Disable public network access on the storage account",
          "Verify connectivity through private endpoints only"
        ],
        "example_fix": "az storage account update --name <storage-account> --resource-group <rg> --public-network-access Disabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-103",
      "title": "Virtual Machine Missing Encryption at Host",
      "description": "Virtual machines should have encryption at host enabled to ensure data at rest on the VM host is encrypted, providing additional protection for sensitive workloads.",
      "severity": "HIGH",
      "rationale": "Encryption at host provides end-to-end encryption including temporary disks, OS and data disk caches, ensuring comprehensive data protection for financial workloads.",
      "detection_criteria": {
        "resource_type": "Microsoft.Compute/virtualMachines",
        "conditions": [
          {
            "field": "properties.securityProfile.encryptionAtHost",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Stop the virtual machine",
          "Enable encryption at host feature",
          "Restart the virtual machine",
          "Verify encryption status"
        ],
        "example_fix": "az vm update --resource-group <rg> --name <vm-name> --set securityProfile.encryptionAtHost=true"
      }
    },
    {
      "id": "CUSTOM-POLICY-104",
      "title": "Network Security Group Allows Unrestricted RDP Access",
      "description": "Network security groups should not allow unrestricted RDP access (port 3389) from the internet. Administrative access should be restricted to specific IP ranges.",
      "severity": "CRITICAL",
      "rationale": "Unrestricted RDP access from the internet is a common attack vector. Administrative interfaces should be segregated and accessible only through secured channels as per the guide's network architecture requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/networkSecurityGroups/securityRules",
        "conditions": [
          {
            "field": "properties.access",
            "equals": "Allow"
          },
          {
            "field": "properties.direction",
            "equals": "Inbound"
          },
          {
            "field": "properties.destinationPortRange",
            "contains": "3389"
          },
          {
            "field": "properties.sourceAddressPrefix",
            "in": [
              "*",
              "Internet",
              "0.0.0.0/0"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Identify legitimate source IP addresses requiring RDP access",
          "Update NSG rule to restrict source to specific IP ranges",
          "Consider using Azure Bastion for administrative access",
          "Implement just-in-time VM access for additional security"
        ],
        "example_fix": "az network nsg rule update --resource-group <rg> --nsg-name <nsg-name> --name <rule-name> --source-address-prefixes <allowed-ip-range>"
      }
    },
    {
      "id": "CUSTOM-POLICY-105",
      "title": "Network Security Group Allows Unrestricted SSH Access",
      "description": "Network security groups should not allow unrestricted SSH access (port 22) from the internet. Administrative access should be restricted to specific IP ranges or through secure channels.",
      "severity": "CRITICAL",
      "rationale": "Unrestricted SSH access increases vulnerability to brute force attacks and unauthorized access. Administrative remote access should be controlled and monitored as per the guide's administrative remote access requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/networkSecurityGroups/securityRules",
        "conditions": [
          {
            "field": "properties.access",
            "equals": "Allow"
          },
          {
            "field": "properties.direction",
            "equals": "Inbound"
          },
          {
            "field": "properties.destinationPortRange",
            "contains": "22"
          },
          {
            "field": "properties.sourceAddressPrefix",
            "in": [
              "*",
              "Internet",
              "0.0.0.0/0"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Identify legitimate source IP addresses requiring SSH access",
          "Update NSG rule to restrict source to specific IP ranges",
          "Implement SSH key-based authentication",
          "Consider using Azure Bastion for administrative access"
        ],
        "example_fix": "az network nsg rule update --resource-group <rg> --nsg-name <nsg-name> --name <rule-name> --source-address-prefixes <allowed-ip-range>"
      }
    },
    {
      "id": "CUSTOM-POLICY-106",
      "title": "SQL Server Missing Advanced Threat Protection",
      "description": "SQL Servers should have Advanced Threat Protection enabled to detect anomalous activities and potential security threats as per the guide's security events monitoring requirements.",
      "severity": "HIGH",
      "rationale": "Advanced Threat Protection provides intelligent threat detection and helps identify potential security incidents early, enabling timely response as required by the incident management controls.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers",
        "conditions": [
          {
            "field": "properties.securityAlertPolicies",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable Advanced Threat Protection on the SQL Server",
          "Configure email notifications for threat alerts",
          "Integrate alerts with SIEM for centralized monitoring",
          "Review and respond to alerts regularly"
        ],
        "example_fix": "az sql server threat-policy update --resource-group <rg> --server <server-name> --state Enabled --email-addresses <admin-email>"
      }
    },
    {
      "id": "CUSTOM-POLICY-107",
      "title": "SQL Server Not Using Transparent Data Encryption",
      "description": "SQL Servers should have Transparent Data Encryption (TDE) enabled to protect data at rest, meeting the guide's encryption requirements for sensitive financial data.",
      "severity": "CRITICAL",
      "rationale": "TDE encrypts database files at rest, ensuring confidentiality of sensitive financial data stored in databases. This is a fundamental control for data protection in cloud environments.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers/databases",
        "conditions": [
          {
            "field": "properties.transparentDataEncryption",
            "notEquals": "Enabled"
          },
          {
            "field": "name",
            "notEquals": "master"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable Transparent Data Encryption on the database",
          "Consider using customer-managed keys for TDE",
          "Verify encryption status",
          "Document key management procedures"
        ],
        "example_fix": "az sql db tde set --resource-group <rg> --server <server-name> --database <db-name> --status Enabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-108",
      "title": "Key Vault Not Using Private Endpoints",
      "description": "Key Vaults should use private endpoints and disable public network access to ensure cryptographic keys are only accessible through secure private connections.",
      "severity": "HIGH",
      "rationale": "Key Vaults store critical cryptographic material. Public network access increases the risk of unauthorized access. Private endpoints ensure keys are accessed only through secured networks.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create private endpoints for the Key Vault",
          "Configure DNS to resolve to private endpoints",
          "Disable public network access",
          "Test key access through private endpoints"
        ],
        "example_fix": "az keyvault update --name <vault-name> --resource-group <rg> --public-network-access Disabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-109",
      "title": "Key Vault Missing Soft Delete Protection",
      "description": "Key Vaults should have soft delete and purge protection enabled to prevent accidental or malicious deletion of cryptographic keys, ensuring data recoverability.",
      "severity": "HIGH",
      "rationale": "Soft delete and purge protection prevent permanent loss of encryption keys. Loss of keys can result in permanent data loss and inability to operate, as noted in the guide's key management section.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "anyOf": [
              {
                "field": "properties.enableSoftDelete",
                "notEquals": true
              },
              {
                "field": "properties.enablePurgeProtection",
                "notEquals": true
              }
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable soft delete on the Key Vault",
          "Enable purge protection",
          "Configure retention period (minimum 90 days recommended)",
          "Document key recovery procedures"
        ],
        "example_fix": "az keyvault update --name <vault-name> --resource-group <rg> --enable-soft-delete true --enable-purge-protection true"
      }
    },
    {
      "id": "CUSTOM-POLICY-110",
      "title": "Web App Not Using HTTPS Only",
      "description": "Web Apps should enforce HTTPS only to ensure all data in transit is encrypted, preventing man-in-the-middle attacks and data interception.",
      "severity": "HIGH",
      "rationale": "Unencrypted HTTP traffic exposes sensitive financial data to interception. HTTPS enforcement ensures confidentiality and integrity of data in transit as required by the guide's encryption controls.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.httpsOnly",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable HTTPS Only setting on the Web App",
          "Ensure valid SSL/TLS certificates are configured",
          "Test application functionality over HTTPS",
          "Update any hard-coded HTTP references"
        ],
        "example_fix": "az webapp update --name <app-name> --resource-group <rg> --set httpsOnly=true"
      }
    },
    {
      "id": "CUSTOM-POLICY-111",
      "title": "Web App Not Using Minimum TLS Version 1.2",
      "description": "Web Apps should enforce minimum TLS version 1.2 or higher to prevent use of weak cryptographic protocols that can be exploited.",
      "severity": "HIGH",
      "rationale": "Older TLS versions have known vulnerabilities. Using TLS 1.2 or higher ensures strong encryption as recommended in the guide's encryption and network security requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.siteConfig.minTlsVersion",
            "notIn": [
              "1.2",
              "1.3"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Update Web App configuration to require TLS 1.2 minimum",
          "Test application compatibility with TLS 1.2",
          "Update client applications if necessary",
          "Monitor for any connection issues"
        ],
        "example_fix": "az webapp config set --name <app-name> --resource-group <rg> --min-tls-version 1.2"
      }
    },
    {
      "id": "CUSTOM-POLICY-112",
      "title": "Container Registry Missing Customer-Managed Keys",
      "description": "Container Registries should use customer-managed encryption keys to maintain control over container image encryption as recommended for sensitive workloads.",
      "severity": "MEDIUM",
      "rationale": "Container images may contain sensitive configuration or proprietary code. Customer-managed keys ensure the FI maintains control over encryption as per the guide's containerization security requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.ContainerRegistry/registries",
        "conditions": [
          {
            "field": "properties.encryption.keyVaultProperties",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify a Key Vault with appropriate access",
          "Generate a customer-managed key in the Key Vault",
          "Configure the Container Registry to use the customer-managed key",
          "Verify encryption settings"
        ],
        "example_fix": "az acr encryption set --name <registry-name> --key-encryption-key <key-identifier> --identity <managed-identity>"
      }
    },
    {
      "id": "CUSTOM-POLICY-113",
      "title": "Virtual Network Missing DDoS Protection",
      "description": "Virtual Networks should have DDoS Protection Standard enabled to protect against distributed denial of service attacks on critical infrastructure.",
      "severity": "HIGH",
      "rationale": "DDoS attacks can disrupt critical financial services. DDoS Protection Standard provides enhanced mitigation capabilities as recommended in the guide's network architecture controls.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/virtualNetworks",
        "conditions": [
          {
            "field": "properties.enableDdosProtection",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify a DDoS Protection Plan",
          "Enable DDoS Protection on the Virtual Network",
          "Configure DDoS telemetry and alerts",
          "Test DDoS response procedures"
        ],
        "example_fix": "az network vnet update --name <vnet-name> --resource-group <rg> --ddos-protection true --ddos-protection-plan <plan-id>"
      }
    },
    {
      "id": "CUSTOM-POLICY-114",
      "title": "Storage Account Missing Logging Configuration",
      "description": "Storage Accounts should have diagnostic logging enabled to monitor access and detect unauthorized activities as required by the guide's security events monitoring.",
      "severity": "MEDIUM",
      "rationale": "Comprehensive logging is essential for security incident detection and investigation. Storage account logs provide visibility into access patterns and potential security events.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.logging",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify a Log Analytics workspace",
          "Enable diagnostic settings for the storage account",
          "Configure logging for blob, queue, table, and file services",
          "Set appropriate retention period"
        ],
        "example_fix": "az monitor diagnostic-settings create --name <setting-name> --resource <storage-account-id> --workspace <workspace-id> --logs '[{\"category\":\"StorageRead\",\"enabled\":true},{\"category\":\"StorageWrite\",\"enabled\":true}]'"
      }
    },
    {
      "id": "CUSTOM-POLICY-115",
      "title": "SQL Server Missing Audit Log Retention",
      "description": "SQL Servers should have audit logging configured with appropriate retention periods to support incident investigation and compliance requirements.",
      "severity": "MEDIUM",
      "rationale": "Audit logs are critical for detecting security events and conducting forensic investigations. The guide requires centralized logging with appropriate retention for security monitoring.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers",
        "conditions": [
          {
            "field": "properties.auditingSettings.retentionDays",
            "lessThan": 90
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable SQL Server auditing",
          "Configure retention period to at least 90 days",
          "Set up storage account or Log Analytics for audit logs",
          "Configure alerts for suspicious activities"
        ],
        "example_fix": "az sql server audit-policy update --resource-group <rg> --server <server-name> --state Enabled --storage-account <storage-account> --retention-days 90"
      }
    },
    {
      "id": "CUSTOM-POLICY-116",
      "title": "Storage Account Missing Immutable Blob Storage",
      "description": "Storage Accounts used for backup and archival should have immutable blob storage enabled to prevent tampering with critical data as per the guide's data integrity requirements.",
      "severity": "HIGH",
      "rationale": "Immutable storage prevents deletion or modification of backup data, ensuring data integrity for recovery scenarios and meeting regulatory requirements for data retention.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts/blobServices/containers",
        "conditions": [
          {
            "field": "properties.immutableStorageWithVersioning",
            "exists": false
          },
          {
            "field": "name",
            "contains": "backup"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable immutable blob storage on backup containers",
          "Configure time-based retention policy",
          "Test restore procedures with immutable storage",
          "Document retention policy requirements"
        ],
        "example_fix": "az storage container immutability-policy create --account-name <storage-account> --container-name <container> --period 365"
      }
    },
    {
      "id": "CUSTOM-POLICY-117",
      "title": "Virtual Machine Missing Backup Configuration",
      "description": "Production virtual machines should have Azure Backup configured to ensure business continuity and disaster recovery capabilities as required by the guide.",
      "severity": "HIGH",
      "rationale": "Regular backups are essential for disaster recovery and business continuity. The guide requires validated backup and recovery procedures for critical systems.",
      "detection_criteria": {
        "resource_type": "Microsoft.Compute/virtualMachines",
        "conditions": [
          {
            "field": "properties.protectionPolicy",
            "exists": false
          },
          {
            "field": "tags.Environment",
            "equals": "Production"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify a Recovery Services Vault",
          "Configure backup policy with appropriate retention",
          "Enable backup for the virtual machine",
          "Perform test restore to validate backup"
        ],
        "example_fix": "az backup protection enable-for-vm --resource-group <rg> --vault-name <vault-name> --vm <vm-name> --policy-name <policy-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-118",
      "title": "Key Vault Missing Access Policy Restrictions",
      "description": "Key Vaults should use least privilege access policies, restricting access to only necessary identities and operations as per the guide's privileged access management requirements.",
      "severity": "HIGH",
      "rationale": "Overly permissive Key Vault access increases risk of unauthorized key usage or exposure. Access should be limited to specific identities with only required permissions.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "field": "properties.accessPolicies[*].permissions.keys",
            "contains": "all"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Review current access policies and identify excessive permissions",
          "Update access policies to grant minimum required permissions",
          "Remove any 'all' permissions grants",
          "Implement regular access reviews"
        ],
        "example_fix": "az keyvault set-policy --name <vault-name> --object-id <object-id> --key-permissions get list --secret-permissions get list"
      }
    },
    {
      "id": "CUSTOM-POLICY-119",
      "title": "Web App Missing Authentication Configuration",
      "description": "Web Apps should have authentication enabled to ensure only authorized users can access the application, supporting the guide's user access management requirements.",
      "severity": "HIGH",
      "rationale": "Unauthenticated access to web applications increases security risk. Authentication should be enforced for all applications handling sensitive financial data.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.siteConfig.authSettings.enabled",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Configure authentication provider (Azure AD recommended)",
          "Enable authentication on the Web App",
          "Configure required authentication scopes",
          "Test authentication flow"
        ],
        "example_fix": "az webapp auth update --name <app-name> --resource-group <rg> --enabled true --action LoginWithAzureActiveDirectory"
      }
    },
    {
      "id": "CUSTOM-POLICY-120",
      "title": "Container Registry Allows Unrestricted Network Access",
      "description": "Container Registries should restrict network access to prevent unauthorized access to container images, which may contain sensitive configuration or code.",
      "severity": "HIGH",
      "rationale": "Container images may contain sensitive application code and configuration. Restricting network access ensures images are only accessible from authorized networks.",
      "detection_criteria": {
        "resource_type": "Microsoft.ContainerRegistry/registries",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "equals": "Enabled"
          },
          {
            "field": "properties.networkRuleSet.defaultAction",
            "equals": "Allow"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Configure network rules to allow only specific IP ranges",
          "Consider using private endpoints for internal access",
          "Set default action to Deny",
          "Test access from authorized networks"
        ],
        "example_fix": "az acr update --name <registry-name> --default-action Deny && az acr network-rule add --name <registry-name> --ip-address <allowed-ip-range>"
      }
    }
  ],
  "manual_checks": [
    "Governance forum establishment and periodic review meetings",
    "Third-party risk assessment and concentration risk evaluation",
    "Service Level Agreement negotiation and enforcement",
    "Data sovereignty and cross-border transfer compliance",
    "Change management process alignment between FI and CSP",
    "Business continuity and disaster recovery plan validation",
    "Security incident response coordination procedures",
    "Privileged user access reviews and segregation of duties",
    "Post-implementation reviews and control effectiveness testing",
    "Exit planning and data deletion verification procedures",
    "Multi-cloud strategy and concentration risk management",
    "DevSecOps pipeline security controls validation",
    "Penetration testing coordination with CSP",
    "Capacity planning and performance testing",
    "Vulnerability remediation SLA compliance tracking",
    "Security awareness training for cloud operations staff"
  ]
}
{
  "category": "Custom Policy",
  "subcategory": "Generated from ABS Cloud Computing Implementation Guide 3.0",
  "version": "1.0.0",
  "generated_at": "2025-12-04T02:35:15.500Z",
  "source_document": "abs-cloud-computing-implementation-guide---july-2024.md",
  "source_repo": "sectuary/CompliancePolicy",
  "standards": [
    {
      "id": "CUSTOM-POLICY-101",
      "title": "Storage Account Public Network Access Not Disabled",
      "description": "Storage accounts should have public network access disabled to prevent unauthorized access from the internet. All access should be through private endpoints or service endpoints.",
      "severity": "CRITICAL",
      "rationale": "Public cloud environments require strict network controls. Direct internet access increases attack surface and violates the principle of network segmentation recommended in Section 3.B.4.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Disable public network access on the storage account",
          "Configure private endpoints or service endpoints for access",
          "Update firewall rules to allow only specific virtual networks"
        ],
        "example_fix": "az storage account update --name <storage-account-name> --resource-group <rg-name> --public-network-access Disabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-102",
      "title": "Storage Account Encryption Not Using Customer-Managed Keys",
      "description": "Storage accounts should use customer-managed keys (CMK) for encryption to maintain control over cryptographic material as required by the guide's key management controls.",
      "severity": "HIGH",
      "rationale": "Section 3.B.5 requires FIs to generate and manage their own cryptographic keys. Customer-managed keys provide greater control over key lifecycle and meet FIPS 140-2 Level 2 requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.encryption.keySource",
            "notEquals": "Microsoft.Keyvault"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create a Key Vault with appropriate access policies",
          "Generate or import a customer-managed key",
          "Configure storage account to use the CMK for encryption"
        ],
        "example_fix": "az storage account update --name <storage-account-name> --resource-group <rg-name> --encryption-key-source Microsoft.Keyvault --encryption-key-vault <vault-uri> --encryption-key-name <key-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-103",
      "title": "Network Security Group Allows Unrestricted Internet Ingress",
      "description": "Network Security Groups should not allow unrestricted inbound access from the internet (0.0.0.0/0) on any port to prevent unauthorized access attempts.",
      "severity": "CRITICAL",
      "rationale": "Section 3.B.4 mandates network segmentation and restricting internet access. Unrestricted ingress rules violate the need-to-basis access principle and increase exposure to network-based attacks.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/networkSecurityGroups/securityRules",
        "conditions": [
          {
            "field": "properties.direction",
            "equals": "Inbound"
          },
          {
            "field": "properties.access",
            "equals": "Allow"
          },
          {
            "field": "properties.sourceAddressPrefix",
            "in": [
              "*",
              "0.0.0.0/0",
              "Internet"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Review and restrict source IP ranges to specific trusted addresses",
          "Implement application gateway or firewall for public-facing services",
          "Use private endpoints for internal services"
        ],
        "example_fix": "az network nsg rule update --nsg-name <nsg-name> --resource-group <rg-name> --name <rule-name> --source-address-prefixes <specific-ip-range>"
      }
    },
    {
      "id": "CUSTOM-POLICY-104",
      "title": "Key Vault Soft Delete Not Enabled",
      "description": "Key Vaults must have soft delete enabled to protect against accidental or malicious deletion of cryptographic keys, as required by cryptographic key management controls.",
      "severity": "HIGH",
      "rationale": "Section 3.B.5 emphasizes protecting cryptographic material from compromise. Soft delete provides recovery capability for accidentally deleted keys that could render data irrecoverable.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "field": "properties.enableSoftDelete",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable soft delete on the Key Vault",
          "Configure retention period (recommended 90 days)",
          "Enable purge protection for critical vaults"
        ],
        "example_fix": "az keyvault update --name <vault-name> --resource-group <rg-name> --enable-soft-delete true --retention-days 90"
      }
    },
    {
      "id": "CUSTOM-POLICY-105",
      "title": "Key Vault Not Using Private Endpoint",
      "description": "Key Vaults containing cryptographic material should use private endpoints and disable public network access to prevent unauthorized access attempts.",
      "severity": "HIGH",
      "rationale": "Section 3.B.5 requires storing encryption keys separately with strict network controls. Public access to Key Vault violates network segmentation principles and increases attack surface.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create a private endpoint for the Key Vault",
          "Disable public network access",
          "Update applications to use private endpoint connection"
        ],
        "example_fix": "az keyvault update --name <vault-name> --resource-group <rg-name> --public-network-access Disabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-106",
      "title": "SQL Server Auditing Not Enabled",
      "description": "SQL Servers must have auditing enabled to capture security events and administrative actions for security monitoring and incident investigation.",
      "severity": "HIGH",
      "rationale": "Section 3.B.14 requires security events monitoring and logging at granular levels. Auditing provides detailed logs for investigating security incidents and detecting unauthorized activities.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers",
        "conditions": [
          {
            "field": "properties.auditingSettings.state",
            "notEquals": "Enabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable auditing on SQL Server",
          "Configure audit log destination (Storage Account or Log Analytics)",
          "Set retention period according to policy requirements"
        ],
        "example_fix": "az sql server audit-policy update --resource-group <rg-name> --server <server-name> --state Enabled --storage-account <storage-account-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-107",
      "title": "SQL Server Transparent Data Encryption Not Enabled",
      "description": "SQL databases should have Transparent Data Encryption (TDE) enabled to protect data at rest, especially for databases containing sensitive financial information.",
      "severity": "CRITICAL",
      "rationale": "Section 3.B.6 requires encryption of sensitive data at rest. TDE provides automatic encryption for database files, meeting confidentiality requirements for financial data.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers/databases",
        "conditions": [
          {
            "field": "properties.transparentDataEncryption.state",
            "notEquals": "Enabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable Transparent Data Encryption on the database",
          "Consider using customer-managed keys for TDE",
          "Verify encryption status after enablement"
        ],
        "example_fix": "az sql db tde set --resource-group <rg-name> --server <server-name> --database <db-name> --status Enabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-108",
      "title": "Virtual Machine Disk Encryption Not Enabled",
      "description": "Virtual machines should have disk encryption enabled using Azure Disk Encryption to protect data at rest on compute resources.",
      "severity": "HIGH",
      "rationale": "Section 3.B.6 mandates encryption of sensitive data at rest. VM disk encryption protects against unauthorized access to data if disks are compromised or accessed offline.",
      "detection_criteria": {
        "resource_type": "Microsoft.Compute/virtualMachines",
        "conditions": [
          {
            "field": "properties.storageProfile.osDisk.encryptionSettings.enabled",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or use existing Key Vault for encryption keys",
          "Enable Azure Disk Encryption on the VM",
          "Verify encryption status on all disks"
        ],
        "example_fix": "az vm encryption enable --resource-group <rg-name> --name <vm-name> --disk-encryption-keyvault <keyvault-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-109",
      "title": "Container Registry Not Using Private Endpoint",
      "description": "Container registries should use private endpoints and disable public network access to secure container images from unauthorized access.",
      "severity": "HIGH",
      "rationale": "Section 3.B.2 addresses securing container images. Public access to registries could expose proprietary code and vulnerabilities, violating network segmentation requirements.",
      "detection_criteria": {
        "resource_type": "Microsoft.ContainerRegistry/registries",
        "conditions": [
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create private endpoint for container registry",
          "Disable public network access",
          "Update pull configurations to use private endpoint"
        ],
        "example_fix": "az acr update --name <registry-name> --resource-group <rg-name> --public-network-enabled false"
      }
    },
    {
      "id": "CUSTOM-POLICY-110",
      "title": "Diagnostic Settings Not Configured for Security Logging",
      "description": "Resources should have diagnostic settings configured to send security logs to centralized logging (Log Analytics or Storage Account) for security monitoring.",
      "severity": "HIGH",
      "rationale": "Section 3.B.14 requires consolidation of logs to centralized system. Diagnostic settings enable streaming of security events to SIEM for correlation and incident detection.",
      "detection_criteria": {
        "resource_type": "Microsoft.Insights/diagnosticSettings",
        "conditions": [
          {
            "field": "properties.logs",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create diagnostic settings for the resource",
          "Configure log categories (SecurityAudit, Administrative)",
          "Set destination to Log Analytics workspace or Storage Account"
        ],
        "example_fix": "az monitor diagnostic-settings create --name <settings-name> --resource <resource-id> --workspace <workspace-id> --logs '[{\"category\":\"Administrative\",\"enabled\":true}]'"
      }
    },
    {
      "id": "CUSTOM-POLICY-111",
      "title": "Web App Not Using HTTPS Only",
      "description": "Web applications must enforce HTTPS-only connections to ensure data in transit is encrypted, preventing interception of sensitive information.",
      "severity": "CRITICAL",
      "rationale": "Section 3.B.6 requires encryption of data in motion. HTTPS-only enforcement prevents unencrypted HTTP traffic that could expose authentication credentials or financial data.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.httpsOnly",
            "notEquals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable HTTPS Only setting on the web app",
          "Verify TLS version is 1.2 or higher",
          "Test application functionality after enabling"
        ],
        "example_fix": "az webapp update --name <app-name> --resource-group <rg-name> --set httpsOnly=true"
      }
    },
    {
      "id": "CUSTOM-POLICY-112",
      "title": "Web App Not Using Minimum TLS Version 1.2",
      "description": "Web applications should enforce TLS 1.2 or higher to protect data in transit with strong cryptographic protocols.",
      "severity": "HIGH",
      "rationale": "Section 3.B.6 emphasizes using strong encryption algorithms. TLS versions below 1.2 have known vulnerabilities and do not meet current security standards for financial institutions.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.siteConfig.minTlsVersion",
            "notIn": [
              "1.2",
              "1.3"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Update minimum TLS version to 1.2 or 1.3",
          "Test client compatibility",
          "Update any legacy clients or APIs"
        ],
        "example_fix": "az webapp config set --name <app-name> --resource-group <rg-name> --min-tls-version 1.2"
      }
    },
    {
      "id": "CUSTOM-POLICY-113",
      "title": "SQL Server Advanced Threat Protection Not Enabled",
      "description": "SQL Servers should have Advanced Threat Protection enabled to detect anomalous activities and potential security threats in real-time.",
      "severity": "HIGH",
      "rationale": "Section 3.B.14 requires security event monitoring to detect suspicious activities. Advanced Threat Protection provides automated detection of SQL injection, data exfiltration, and unusual access patterns.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers",
        "conditions": [
          {
            "field": "properties.securityAlertPolicies.state",
            "notEquals": "Enabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable Advanced Threat Protection on SQL Server",
          "Configure email notifications for security alerts",
          "Integrate with Security Center for centralized monitoring"
        ],
        "example_fix": "az sql server threat-policy update --resource-group <rg-name> --server <server-name> --state Enabled --email-addresses <admin-email>"
      }
    },
    {
      "id": "CUSTOM-POLICY-114",
      "title": "Storage Account Not Using Private Endpoint for Blob Service",
      "description": "Storage account blob services should use private endpoints to prevent public internet access to data stored in containers.",
      "severity": "HIGH",
      "rationale": "Section 3.B.4 requires dedicated security network segments for all egress traffic. Private endpoints ensure blob data access is restricted to authorized virtual networks only.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.privateEndpointConnections",
            "exists": false
          },
          {
            "field": "properties.publicNetworkAccess",
            "notEquals": "Disabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create private endpoint for blob service",
          "Configure DNS for private endpoint resolution",
          "Disable public network access after validating connectivity"
        ],
        "example_fix": "az network private-endpoint create --name <pe-name> --resource-group <rg-name> --vnet-name <vnet-name> --subnet <subnet-name> --private-connection-resource-id <storage-account-id> --group-id blob --connection-name <connection-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-115",
      "title": "Storage Account Not Using Immutable Blob Storage",
      "description": "Storage accounts used for audit logs and backups should have immutable blob storage enabled to prevent tampering or deletion of critical data.",
      "severity": "MEDIUM",
      "rationale": "Section 3.B.15 requires securing logs and backups against unauthorized modification. Immutable storage provides WORM (Write Once Read Many) capability for compliance and forensic purposes.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts/blobServices/containers",
        "conditions": [
          {
            "field": "properties.immutableStorageWithVersioning.enabled",
            "notEquals": true
          },
          {
            "field": "name",
            "matches": ".*(log|audit|backup).*"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable versioning on the storage account",
          "Configure immutable storage policy on container",
          "Set appropriate retention period for compliance requirements"
        ],
        "example_fix": "az storage container immutability-policy create --account-name <storage-account-name> --container-name <container-name> --period 365"
      }
    },
    {
      "id": "CUSTOM-POLICY-116",
      "title": "Key Vault Keys Not Set for Automatic Rotation",
      "description": "Cryptographic keys in Key Vault should have automatic rotation enabled to comply with key lifecycle management requirements.",
      "severity": "MEDIUM",
      "rationale": "Section 3.B.5 requires regular key rotation according to industry best practices. Automatic rotation reduces risk of key compromise and ensures compliance with cryptographic policies.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults/keys",
        "conditions": [
          {
            "field": "properties.rotationPolicy",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Define key rotation policy with appropriate frequency",
          "Configure automatic rotation in Key Vault",
          "Update applications to handle key rotation gracefully"
        ],
        "example_fix": "az keyvault key rotation-policy update --vault-name <vault-name> --name <key-name> --value '{\"lifetimeActions\":[{\"trigger\":{\"timeAfterCreate\":\"P90D\"},\"action\":{\"type\":\"Rotate\"}}],\"attributes\":{\"expiryTime\":\"P365D\"}}'"
      }
    },
    {
      "id": "CUSTOM-POLICY-117",
      "title": "Virtual Network Not Using Network Security Groups",
      "description": "Virtual network subnets should have Network Security Groups attached to control and filter network traffic according to security requirements.",
      "severity": "HIGH",
      "rationale": "Section 3.B.4 mandates network segmentation and access controls. NSGs provide essential firewall rules to restrict traffic between subnets and prevent lateral movement.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/virtualNetworks/subnets",
        "conditions": [
          {
            "field": "properties.networkSecurityGroup",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create Network Security Group with appropriate rules",
          "Associate NSG with the subnet",
          "Document and review rules regularly"
        ],
        "example_fix": "az network vnet subnet update --name <subnet-name> --vnet-name <vnet-name> --resource-group <rg-name> --network-security-group <nsg-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-118",
      "title": "Log Analytics Workspace Data Retention Not Configured",
      "description": "Log Analytics workspaces should have data retention configured according to regulatory and compliance requirements for security log preservation.",
      "severity": "MEDIUM",
      "rationale": "Section 3.B.15 requires log retention aligned with FI record retention policy. Adequate retention ensures availability of logs for forensic investigation and regulatory compliance.",
      "detection_criteria": {
        "resource_type": "Microsoft.OperationalInsights/workspaces",
        "conditions": [
          {
            "field": "properties.retentionInDays",
            "lessThan": 90
          }
        ]
      },
      "remediation": {
        "steps": [
          "Review regulatory requirements for log retention",
          "Update workspace retention to minimum 90 days",
          "Configure archive for long-term storage if needed"
        ],
        "example_fix": "az monitor log-analytics workspace update --resource-group <rg-name> --workspace-name <workspace-name> --retention-time 90"
      }
    }
  ],
  "manual_checks": [
    "Multi-Factor Authentication enforcement for privileged accounts (Section 3.B.8)",
    "Segregation of duties for user access administration (Section 3.B.8)",
    "Regular user access reviews and recertification (Section 3.B.8)",
    "Incident response plan testing and validation (Section 3.C.4)",
    "Disaster recovery testing with CSP participation (Section 3.C.7)",
    "Contractual agreements with CSP covering SLAs and change notification (Section 2.2)",
    "CSP subcontractor due diligence and approval process (Section 2.2)",
    "Cloud governance forum establishment and meeting frequency (Section 3.A.1)",
    "Penetration testing coordination with CSP (Section 3.B.13)",
    "Break-glass procedure documentation and review (Section 3.B.9)",
    "Data classification policy for cloud assets (Section 2.2)",
    "Exit planning and data deletion verification (Section 2.2)",
    "Source code review process integration with CI/CD (Section 3.B.12)",
    "Capacity planning and business volume forecasting (Section 3.C.5)",
    "Problem management for recurring incidents (Section 3.C.4)"
  ]
}
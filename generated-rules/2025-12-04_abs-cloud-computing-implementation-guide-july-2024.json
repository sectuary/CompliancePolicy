{
  "category": "Custom Policy",
  "subcategory": "Generated from ABS Cloud Computing Implementation Guide 3.0",
  "version": "1.0.0",
  "generated_at": "2025-12-04T02:25:02.562Z",
  "source_document": "abs-cloud-computing-implementation-guide---july-2024.md",
  "source_repo": "sectuary/CompliancePolicy",
  "standards": [
    {
      "id": "CUSTOM-POLICY-101",
      "title": "Storage Account Not Using Geo-Redundant Storage for Critical Data",
      "description": "Storage accounts containing critical data must use geo-redundant storage (GRS or GZRS) to ensure data availability across regions and meet disaster recovery requirements.",
      "severity": "HIGH",
      "rationale": "The ABS guide requires FIs to implement workload distribution across multiple regions for critical services and ensure data availability during regional outages. Geo-redundant storage is essential for business continuity.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "sku.name",
            "notIn": [
              "Standard_GRS",
              "Standard_GZRS",
              "Standard_RAGRS",
              "Standard_RAGZRS"
            ]
          },
          {
            "field": "tags.criticality",
            "in": [
              "critical",
              "high",
              "production"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Review the business criticality of data stored in the storage account",
          "Update storage account replication to geo-redundant storage",
          "Test data recovery from secondary region",
          "Document recovery procedures in disaster recovery plan"
        ],
        "example_fix": "az storage account update --name <storage-account-name> --resource-group <resource-group> --sku Standard_GRS"
      }
    },
    {
      "id": "CUSTOM-POLICY-102",
      "title": "Virtual Network Missing DDoS Protection Standard",
      "description": "Virtual networks hosting production workloads must have DDoS Protection Standard enabled to protect against application layer attacks as required for internet-facing cloud services.",
      "severity": "HIGH",
      "rationale": "ABS guidelines mandate implementation of application layer DDoS protection for cloud-based applications. DDoS Protection Standard provides enhanced mitigation capabilities beyond basic protection.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/virtualNetworks",
        "conditions": [
          {
            "field": "enableDdosProtection",
            "notEquals": true
          },
          {
            "field": "tags.environment",
            "in": [
              "production",
              "prod"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify DDoS Protection Plan",
          "Enable DDoS Protection Standard on the virtual network",
          "Configure DDoS alerts and monitoring",
          "Review and test DDoS response procedures"
        ],
        "example_fix": "az network ddos-protection create --resource-group <rg-name> --name <ddos-plan-name> && az network vnet update --resource-group <rg-name> --name <vnet-name> --ddos-protection true --ddos-protection-plan <ddos-plan-id>"
      }
    },
    {
      "id": "CUSTOM-POLICY-103",
      "title": "Key Vault Missing Firewall and Virtual Network Rules",
      "description": "Key Vaults must restrict network access using firewall rules and virtual network service endpoints to prevent unauthorized access from public networks.",
      "severity": "CRITICAL",
      "rationale": "ABS policy requires FIs to control access to cryptographic material and implement network segmentation. Key Vaults should not be accessible from all networks to protect sensitive keys and secrets.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults",
        "conditions": [
          {
            "field": "properties.networkAcls.defaultAction",
            "notEquals": "Deny"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Configure Key Vault firewall to deny default access",
          "Add specific IP ranges or virtual network rules for authorized access",
          "Enable private endpoint for secure connectivity",
          "Test access from authorized and unauthorized networks"
        ],
        "example_fix": "az keyvault update --name <vault-name> --resource-group <rg-name> --default-action Deny && az keyvault network-rule add --name <vault-name> --resource-group <rg-name> --vnet-name <vnet-name> --subnet <subnet-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-104",
      "title": "SQL Server Not Restricting Network Access to Specific IP Ranges",
      "description": "SQL Servers must restrict network access to specific IP ranges or virtual networks rather than allowing access from all Azure services or public internet.",
      "severity": "CRITICAL",
      "rationale": "ABS guidelines require FIs to implement network access controls and secure database access. Unrestricted network access violates the principle of least privilege and increases attack surface.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers/firewallRules",
        "conditions": [
          {
            "field": "properties.startIpAddress",
            "equals": "0.0.0.0"
          },
          {
            "field": "properties.endIpAddress",
            "equals": "0.0.0.0"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Remove the 'Allow Azure services' firewall rule",
          "Configure specific IP ranges for authorized access",
          "Implement virtual network rules for private connectivity",
          "Enable private endpoint for production databases"
        ],
        "example_fix": "az sql server firewall-rule delete --resource-group <rg-name> --server <server-name> --name AllowAllWindowsAzureIps && az sql server vnet-rule create --resource-group <rg-name> --server <server-name> --name <rule-name> --vnet-name <vnet-name> --subnet <subnet-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-105",
      "title": "Storage Account Not Enforcing Minimum TLS Version 1.2",
      "description": "Storage accounts must enforce minimum TLS version 1.2 to ensure secure data transmission and comply with encryption standards.",
      "severity": "HIGH",
      "rationale": "ABS policy requires encryption of data in transit using strong cryptographic protocols. TLS 1.2 is the minimum acceptable version for secure communications.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.minimumTlsVersion",
            "notIn": [
              "TLS1_2",
              "TLS1_3"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Update storage account to enforce minimum TLS 1.2",
          "Test applications for TLS 1.2 compatibility",
          "Update client applications if needed",
          "Monitor for connection failures"
        ],
        "example_fix": "az storage account update --name <storage-account-name> --resource-group <resource-group> --min-tls-version TLS1_2"
      }
    },
    {
      "id": "CUSTOM-POLICY-106",
      "title": "Virtual Machine Not Using Managed Disks with Encryption",
      "description": "Virtual machines must use managed disks with server-side encryption to protect data at rest as per ABS encryption requirements.",
      "severity": "HIGH",
      "rationale": "ABS guidelines mandate encryption at rest for all sensitive data. Managed disks with server-side encryption provide automatic encryption of virtual machine storage.",
      "detection_criteria": {
        "resource_type": "Microsoft.Compute/virtualMachines",
        "conditions": [
          {
            "field": "properties.storageProfile.osDisk.managedDisk",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Convert unmanaged disks to managed disks",
          "Enable server-side encryption on managed disks",
          "Consider using customer-managed keys for additional control",
          "Test VM functionality after conversion"
        ],
        "example_fix": "az vm convert --resource-group <rg-name> --name <vm-name> && az disk update --resource-group <rg-name> --name <disk-name> --encryption-type EncryptionAtRestWithPlatformKey"
      }
    },
    {
      "id": "CUSTOM-POLICY-107",
      "title": "Container Registry Not Using Content Trust",
      "description": "Container registries must enable content trust to ensure container image integrity and prevent deployment of tampered images.",
      "severity": "HIGH",
      "rationale": "ABS policy requires integrity checks on container templates and detection of inconsistencies before use. Content trust provides cryptographic signing of container images.",
      "detection_criteria": {
        "resource_type": "Microsoft.ContainerRegistry/registries",
        "conditions": [
          {
            "field": "properties.policies.trustPolicy.status",
            "notEquals": "enabled"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Enable content trust on the container registry",
          "Configure Docker client to use content trust",
          "Sign container images before pushing",
          "Implement validation in CI/CD pipeline"
        ],
        "example_fix": "az acr config content-trust update --registry <registry-name> --status enabled"
      }
    },
    {
      "id": "CUSTOM-POLICY-108",
      "title": "Web App Not Using Latest Runtime Version",
      "description": "Web applications must use the latest supported runtime version to ensure security patches and vulnerability fixes are applied.",
      "severity": "MEDIUM",
      "rationale": "ABS guidelines require prompt patching and vulnerability management. Using outdated runtime versions exposes applications to known vulnerabilities.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.siteConfig.linuxFxVersion",
            "matches": ".*(DOTNETCORE|2\\.|3\\.[01]).*"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Review application compatibility with latest runtime",
          "Update web app to use latest supported runtime version",
          "Test application functionality after update",
          "Implement runtime version monitoring"
        ],
        "example_fix": "az webapp config set --resource-group <rg-name> --name <app-name> --linux-fx-version 'DOTNETCORE|8.0'"
      }
    },
    {
      "id": "CUSTOM-POLICY-109",
      "title": "SQL Database Not Using Azure AD Authentication",
      "description": "SQL databases must be configured to use Azure AD authentication to enable centralized identity management and multi-factor authentication.",
      "severity": "HIGH",
      "rationale": "ABS policy requires multi-factor authentication for administrative access and centralized identity management. Azure AD authentication enables these capabilities for SQL databases.",
      "detection_criteria": {
        "resource_type": "Microsoft.Sql/servers",
        "conditions": [
          {
            "field": "properties.administrators",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Configure Azure AD administrator for SQL Server",
          "Enable Azure AD authentication",
          "Migrate SQL logins to Azure AD identities",
          "Implement conditional access policies"
        ],
        "example_fix": "az sql server ad-admin create --resource-group <rg-name> --server-name <server-name> --display-name <admin-name> --object-id <admin-object-id>"
      }
    },
    {
      "id": "CUSTOM-POLICY-110",
      "title": "Storage Account Not Using Lifecycle Management for Data Retention",
      "description": "Storage accounts must implement lifecycle management policies to automatically manage data retention and deletion according to the FI's retention policy.",
      "severity": "MEDIUM",
      "rationale": "ABS guidelines require FIs to manage data according to retention policies and ensure data is deleted after the exit of service agreements. Lifecycle management automates this process.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts/managementPolicies",
        "conditions": [
          {
            "field": "properties.policy.rules",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Define data retention requirements based on FI policy",
          "Create lifecycle management policy for storage account",
          "Configure rules to transition or delete data",
          "Test policy with non-production data"
        ],
        "example_fix": "az storage account management-policy create --account-name <storage-account-name> --resource-group <rg-name> --policy @policy.json"
      }
    },
    {
      "id": "CUSTOM-POLICY-111",
      "title": "Key Vault Keys Not Set to Auto-Rotate",
      "description": "Cryptographic keys in Key Vault must be configured with automatic rotation to comply with key lifecycle management requirements.",
      "severity": "HIGH",
      "rationale": "ABS policy requires regular rotation of cryptographic keys according to industry best practices. Auto-rotation ensures keys are rotated without manual intervention.",
      "detection_criteria": {
        "resource_type": "Microsoft.KeyVault/vaults/keys",
        "conditions": [
          {
            "field": "properties.rotationPolicy",
            "exists": false
          },
          {
            "field": "properties.attributes.enabled",
            "equals": true
          }
        ]
      },
      "remediation": {
        "steps": [
          "Define key rotation policy based on key sensitivity",
          "Configure automatic rotation for keys in Key Vault",
          "Update applications to handle key rotation",
          "Test key rotation process"
        ],
        "example_fix": "az keyvault key rotation-policy update --vault-name <vault-name> --name <key-name> --value @rotation-policy.json"
      }
    },
    {
      "id": "CUSTOM-POLICY-112",
      "title": "Virtual Machine Not Part of Availability Set or Zone",
      "description": "Production virtual machines must be deployed in availability sets or availability zones to ensure high availability and meet resiliency requirements.",
      "severity": "HIGH",
      "rationale": "ABS guidelines require FIs to maximize redundancy by distributing production workloads across available clusters/zones to ensure service availability during failures.",
      "detection_criteria": {
        "resource_type": "Microsoft.Compute/virtualMachines",
        "conditions": [
          {
            "field": "properties.availabilitySet",
            "exists": false
          },
          {
            "field": "zones",
            "exists": false
          },
          {
            "field": "tags.environment",
            "equals": "production"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Plan availability set or zone deployment strategy",
          "Redeploy VM in availability set or availability zone",
          "Update load balancer configuration",
          "Test application availability during zone failure"
        ],
        "example_fix": "az vm availability-set create --name <avset-name> --resource-group <rg-name> && az vm create --name <vm-name> --resource-group <rg-name> --availability-set <avset-name>"
      }
    },
    {
      "id": "CUSTOM-POLICY-113",
      "title": "Network Security Group Not Logging Flow Logs",
      "description": "Network Security Groups must have flow logs enabled to monitor network traffic and detect security events as required by ABS monitoring guidelines.",
      "severity": "MEDIUM",
      "rationale": "ABS policy requires security events monitoring and correlation. NSG flow logs provide detailed information for investigating security incidents and detecting anomalies.",
      "detection_criteria": {
        "resource_type": "Microsoft.Network/networkSecurityGroups",
        "conditions": [
          {
            "field": "properties.flowLogs",
            "exists": false
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create storage account for flow logs",
          "Enable NSG flow logs for network security groups",
          "Configure log retention period",
          "Integrate logs with SIEM for analysis"
        ],
        "example_fix": "az network watcher flow-log create --resource-group <rg-name> --nsg <nsg-name> --storage-account <storage-account-id> --name <flow-log-name> --enabled true --retention 90"
      }
    },
    {
      "id": "CUSTOM-POLICY-114",
      "title": "Storage Account Not Using Customer-Managed Keys for Infrastructure Encryption",
      "description": "Storage accounts containing sensitive data must use customer-managed keys for infrastructure encryption to maintain control over cryptographic material.",
      "severity": "HIGH",
      "rationale": "ABS guidelines require FIs to generate and secure their own cryptographic keys in the cloud environment. Customer-managed keys provide full control over encryption keys.",
      "detection_criteria": {
        "resource_type": "Microsoft.Storage/storageAccounts",
        "conditions": [
          {
            "field": "properties.encryption.requireInfrastructureEncryption",
            "notEquals": true
          },
          {
            "field": "tags.dataClassification",
            "in": [
              "confidential",
              "restricted",
              "sensitive"
            ]
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create customer-managed key in Key Vault",
          "Grant storage account access to Key Vault",
          "Enable infrastructure encryption with customer-managed key",
          "Test data access after encryption enablement"
        ],
        "example_fix": "az storage account update --name <storage-account-name> --resource-group <rg-name> --encryption-key-source Microsoft.Keyvault --encryption-key-vault <key-vault-uri> --encryption-key-name <key-name> --require-infrastructure-encryption true"
      }
    },
    {
      "id": "CUSTOM-POLICY-115",
      "title": "Web App Not Using Virtual Network Integration",
      "description": "Production web applications must use virtual network integration to ensure secure connectivity and network isolation as per ABS network security requirements.",
      "severity": "MEDIUM",
      "rationale": "ABS policy requires network segregation and controlled access to cloud resources. VNet integration provides secure connectivity between web apps and backend resources.",
      "detection_criteria": {
        "resource_type": "Microsoft.Web/sites",
        "conditions": [
          {
            "field": "properties.virtualNetworkSubnetId",
            "exists": false
          },
          {
            "field": "tags.environment",
            "equals": "production"
          }
        ]
      },
      "remediation": {
        "steps": [
          "Create or identify subnet for web app integration",
          "Enable virtual network integration on web app",
          "Update network security group rules",
          "Test connectivity to backend resources"
        ],
        "example_fix": "az webapp vnet-integration add --resource-group <rg-name> --name <app-name> --vnet <vnet-name> --subnet <subnet-name>"
      }
    }
  ],
  "manual_checks": [
    "Verify CSP has appropriate business continuity plans and disaster recovery procedures",
    "Review and approve change management procedures with CSP",
    "Validate CSP incident response and notification procedures",
    "Confirm CSP provides adequate training for FI staff on cloud operations",
    "Review CSP's third-party risk management for subcontractors",
    "Validate CSP compliance with data sovereignty requirements",
    "Confirm CSP supports required penetration testing activities",
    "Review CSP's privileged user access management procedures",
    "Validate exit planning and data deletion procedures with CSP",
    "Confirm CSP provides timely notification of material changes"
  ]
}